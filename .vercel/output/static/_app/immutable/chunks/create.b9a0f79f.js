import{g as b,b as w,e as K,c as M,a as O}from"./callbacks.6723c42c.js";import{a as E}from"./index.a1398546.js";import{o as N,k as v}from"./create.6a8ca084.js";import{g as y}from"./portal.080fdab2.js";import{w as D,d as C}from"./index.cb808db3.js";import{D as m}from"./scheduler.2943ef39.js";function A(c,o="default"){const l=b(c);l&&(l.focus(),o==="start"?l.setSelectionRange(0,0):o==="end"&&l.setSelectionRange(l.value.length,l.value.length))}function p(c,o){c?o.set({id:c.getAttribute("data-tag-id")??"",value:c.getAttribute("data-tag-value")??""}):o.set(null)}function k(c,o){var l,f;(l=b(c.root))==null||l.setAttribute("data-invalid",""),(f=b(c.input))==null||f.setAttribute("data-invalid",""),o.set(!0)}function V(c,o){var l,f;(l=b(c.root))==null||l.removeAttribute("data-invalid"),(f=b(c.input))==null||f.removeAttribute("data-invalid"),o.set(!1)}const G={placeholder:"Enter tags...",disabled:!1,tags:[],unique:!1,blur:"nothing",addOnPaste:!1,allowed:[],denied:[]},{name:T,selector:P}=M("tags-input");function Y(c){const o={...G,...c},l=D(N(o,"tags","selected")),f=D(""),x=D(!1),I=D(o.tags&&o.tags.length>0?typeof o.tags[0]=="string"?o.tags.map(t=>({id:y(),value:t})):o.tags:[]),R=t=>{const s=m(l),n=m(I);return!(s.unique&&n.findIndex(a=>a.value===t)>=0||s.allowed&&s.allowed.length>0&&!s.allowed.includes(t)||s.denied&&s.denied.length>0&&s.denied.includes(t)||s.maxTags&&s.maxTags>0&&n.length>=s.maxTags)},r=D(o.selected??null),S=async t=>{const s=m(l);let n;if(s.add)try{const e=await s.add(t);typeof e=="string"?n={id:y(),value:e}:(n=e,n.id||(n.id=y()))}catch{return k(u,x),!1}else n={id:y(),value:t};return I.update(e=>[...e,n]),!0},L=async t=>{const s=m(l);if(s.remove)try{if(!await s.remove(t))return!1}catch{return k(u,x),!1}const e=m(I).findIndex(a=>a.id===t.id);return I.update(a=>(a.splice(e,1),a)),!0},u={root:y(),input:y()},_=w(T(""),{stores:l,returned:t=>({"data-disabled":t.disabled?!0:void 0,"data-melt-id":u.root,disabled:t.disabled}),action:t=>({destroy:O(E(t,"mousedown",n=>{A(u.input);const e=n.target.closest(P("tag"));e&&(n.preventDefault(),p(e,r))}),E(t,"click",n=>{A(u.input);const e=n.target.closest(P("tag"));p(e,r)}))})}),q=w(T("input"),{stores:l,returned:t=>({"data-melt-id":u.input,"data-disabled":t.disabled?"":void 0,disabled:t.disabled,placeholder:t.placeholder}),action:t=>{const s=e=>{const a=b(u.root);let i=[],d=-1,g=-1,h=-1;return a&&(i=Array.from(a.querySelectorAll(P("tag"))),d=i.findIndex(W=>W.getAttribute("data-tag-id")===e),g=d-1,h=d+1),{tagsEl:i,selectedIndex:d,prevIndex:g,nextIndex:h}};return{destroy:O(E(t,"focus",()=>{const e=b(u.root);e&&e.setAttribute("data-focus",""),t.setAttribute("data-focus","")}),E(t,"blur",async()=>{const e=b(u.root);e&&e.removeAttribute("data-focus"),t.removeAttribute("data-focus"),r.set(null);const a=t.value;if(!a)return;const i=m(l);i.blur==="clear"?t.value="":i.blur==="add"&&(R(a)&&await S(a)?(t.value="",f.set("")):k(u,x))}),E(t,"paste",async e=>{if(!e.clipboardData)return;const a=e.clipboardData.getData("text");!a||!m(l).addOnPaste||(R(a)?(e.preventDefault(),await S(a)?t.value="":t.value=a):k(u,x))}),E(t,"keydown",async e=>{const a=m(r);if(a){if(e.key.length===1)r.set(null);else if(e.key===v.ARROW_LEFT){e.preventDefault();const{tagsEl:i,prevIndex:d}=s(a.id);d>=0&&p(i[d],r)}else if(e.key===v.ARROW_RIGHT){e.preventDefault();const{tagsEl:i,nextIndex:d}=s(a.id);d===-1||d>=i.length?(r.set(null),A(u.input,"start")):p(i[d],r)}else if(e.key===v.HOME){e.preventDefault();const{tagsEl:i}=s(a.id);i.length>0&&p(i[0],r)}else if(e.key===v.END)e.preventDefault(),r.set(null),A(u.input);else if(e.key===v.DELETE){e.preventDefault();const i=a,{tagsEl:d,nextIndex:g}=s(a.id);g===-1||g>=d.length?(r.set(null),A(u.input)):p(d[g],r),await L(i)||r.set(i)}else if(e.key===v.BACKSPACE){e.preventDefault();const i=a,{tagsEl:d,nextIndex:g,prevIndex:h}=s(a.id);h>=0?p(d[h],r):g===-1||g>=d.length?(r.set(null),A(u.input,"start")):p(d[g],r),await L(i)||r.set(i)}}else if(e.key===v.ENTER){e.preventDefault();const i=t.value;if(!i)return;R(i)?await S(i)&&(t.value="",f.set("")):k(u,x)}else if(t.selectionStart===0&&t.selectionEnd===0&&(e.key===v.ARROW_LEFT||e.key===v.BACKSPACE)){e.preventDefault();const{tagsEl:i}=s(""),d=i.at(-1);p(d,r)}}),E(t,"input",e=>{f.set(e.target.value)}))}}}),B=w(T("tag"),{stores:[r,l],returned:([t,s])=>n=>{const e=s.disabled||n.disabled,a=e?void 0:(t==null?void 0:t.id)===(n==null?void 0:n.id);return{"aria-selected":a,"data-selected":a?"":void 0,"data-tag-value":n.value,"data-tag-id":n.id,"data-disabled":e?"":void 0,disabled:e,tabindex:-1}}}),F=w(T("delete-trigger"),{stores:[r,l],returned:([t,s])=>n=>{const e=s.disabled||n.disabled,a=e?void 0:(t==null?void 0:t.id)===(n==null?void 0:n.id);return{"aria-selected":a,"data-selected":a?"":void 0,"data-tag-value":n.value,"data-tag-id":n.id,"data-disabled":e?"":void 0,disabled:e,tabindex:-1}},action:t=>{const s=()=>{const e=t.getAttribute("data-tag-value")??"",a=t.getAttribute("data-tag-id")??"",i=t.hasAttribute("data-disabled");return{value:e,id:a,disabled:i}};return{destroy:O(E(t,"click",e=>{e.stopPropagation();const a=s();if(a.disabled)return;L({id:a.id,value:a.value});const i=b(u.input);i&&i.focus()}))}}}),H=C(r,t=>s=>(t==null?void 0:t.id)===s.id);return K(f,()=>{V(u,x)}),{root:_,tag:B,deleteTrigger:F,input:q,options:l,tags:I,value:C(f,t=>t),invalid:C(x,t=>t),selected:r,isSelected:H}}export{Y as c};
